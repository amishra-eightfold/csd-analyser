# Support Ticket Analysis Application PRD

## Overview
This app provides a simple interface for users to query and analyze support ticket data from Salesforce.

## Core Features

### 1. Landing Page
- Customer picklist preloaded from Salesforce, supporting multiple customer selection
- Date range picker with customizable start and end dates
- Connection status indicator for Salesforce integration

### 2. Data Flow
- Automatic SOQL query generation based on selections
- Data fetching from Salesforce using the following fields:
  - `Id`, `CaseNumber`, `Account.Account_Name__c`, `CreatedDate`, `ClosedDate`, `Status`
  - `Subject`, `Description`, `Priority`, `Internal_Priority__c`, `Product_Area__c`, `Product_Feature__c`
  - `RCA__c`, `CSAT__c`, `First_Response_Time__c`, `Case_Type__c`
- Analysis and visualization generation with error handling
- Priority determination using `Internal_Priority__c` field with fallback to regular `Priority`

### 3. Filtering Capabilities
- Ticket type filtering
  - Automatic exclusion of 'Service Request' tickets from main case analysis
  - Dedicated section for Service Request analysis
- Product Area filter using `Product_Area__c` field
  - Multi-select filter showing all available product areas
  - Updates all visualizations in real-time
- Status filter for open/closed tickets
- Text search capabilities across ticket data
- Pagination support for viewing large datasets

### 4. Visualizations
1. Ticket Volume Analysis
   - Bar chart showing created and closed tickets month over month
   - Interactive tooltips displaying percentage changes
   - Secondary axis displaying backlog trends
   - Support for daily, weekly, and monthly aggregation
   - Excludes tickets where Case_Type__c = 'Service Request'

2. Response Time Analysis
   - Box plots showing first response time distribution by priority level
   - SLA threshold indicators (1hr for P0, 24hrs for P1, 48hrs for P2)
   - Metrics for average and median response times
   - Excludes tickets where Case_Type__c = 'Service Request'

3. Customer Satisfaction
   - CSAT distribution bar chart colored by satisfaction level
   - Clear display of average CSAT score
   - Visual indicators for satisfaction trends
   - Excludes tickets where Case_Type__c = 'Service Request'

4. Resolution Analysis
   - Average time to resolve by priority with error bars
   - Min/max/median resolution time indicators
   - Interactive tooltips with detailed statistics
   - Time spent in each priority level for tickets with priority changes (closed tickets only)
   - Time spent in each status across the ticket lifecycle
   - Excludes tickets where Case_Type__c = 'Service Request'

5. Product Distribution
   - Bar chart showing ticket volume by product area
   - Percentage indicators for each product area
   - Support for handling large numbers of product areas
   - Excludes tickets where Case_Type__c = 'Service Request'

6. Text Analysis
   - Word cloud visualization of the 'Subject' or 'Description' fields
   - Technical stopword filtering
   - Support for analyzing comment text
   - Excludes tickets where Case_Type__c = 'Service Request'

7. Root Cause Analysis
   - Distribution of root causes (bar chart)
   - Root cause by product area heatmap
   - Proportion visualization with color scale
   - Excludes tickets where Case_Type__c = 'Service Request'

### 5. Service Request Analysis
1. Volume Analysis
   - Month over month volume of service requests
   - Trend visualization with comparison to previous periods
   - Interactive tooltips showing volume changes

2. Resolution Time Analysis
   - Average time to resolve service requests
   - Resolution time trends over time
   - Comparison with non-service request tickets

3. Priority Change Analysis
   - Average time spent by tickets in different priorities when the priority changed during the lifecycle
   - Analysis limited to closed tickets only
   - Comparison with non-service request tickets

4. Status Duration Analysis
   - Average time spent in various statuses throughout the ticket lifecycle
   - Breakdown by priority level
   - Identification of bottlenecks in the service request workflow

### 6. Export Capabilities
1. CSV Export
   - Raw data export with proper encoding
   - Automatic timestamp in filename
   - UTF-8 encoding support
   - One-click download from data table view
   - Option to include/exclude service requests

### 7. Detailed Ticket Analysis
1. Additional Data Retrieval
   - Fetch of comments via CaseComment object
   - Fetch of history data via CaseHistory object
   - Support for priority history analysis
   - Progress indicator during data fetch

2. OpenAI Analysis Integration
   - Option to send detailed ticket data to OpenAI for advanced analysis
   - AI-generated insights and recommendations
   - Pattern recognition in customer issues
   - PII protection with automatic sanitization
   - Four analysis types: Ticket Categorization, Pattern Detection, Root Cause Analysis, and Trend Analysis

   a. Token Management and Data Processing
      - Chunk processing for large datasets
      - Smart prioritization of data when approaching token limits
      - Error handling for API failures

   b. Data Completeness Assurance
      - Validation of data before processing
      - Fallback to available data when complete data isn't available
      - Graceful handling of missing fields

   c. Error Handling and Recovery
      - Clear error messages for failed analysis
      - Logging of analysis attempts and results
      - Debug mode for troubleshooting

### 8. Privacy and PII Protection
1. PII Detection and Removal
   - Regex-based detection of:
     * Email addresses (multiple formats)
     * Phone numbers (domestic and international)
     * URLs and IP addresses
     * Names with title patterns
     * Password information
   - Standardized placeholder replacement ([EMAIL], [PHONE], etc.)
   - Toggle for enabling/disabling PII protection

2. Privacy Features
   - Pre-processing pipeline for text data
   - User interface indicators for privacy status
   - Processing of DataFrame text columns

## Technical Requirements
1. Performance
   - Support for large ticket datasets with pagination
   - Visualization rendering optimizations
   - Efficient data filtering and processing

2. Data Handling
   - Proper date/time formatting and timezone handling
   - Handling of missing fields (First_Response_Time__c, Internal_Priority__c)
   - Field fallback mechanisms for robustness
   - Error handling with user-friendly messages
   - Ticket type-based filtering (Service Request vs. regular tickets)

3. UI/UX
   - Responsive chart layouts
   - Interactive visualizations with tooltips
   - Loading indicators during data processing
   - Error states with helpful messaging
   - Debug mode for advanced troubleshooting
   - Clear separation between ticket types in the UI

## Future Considerations
1. PowerPoint export integration
2. PDF report generation
3. Scheduled exports
4. Custom visualization builder
5. Saved filter presets
6. Custom AI model training
7. Batch processing for multiple accounts 